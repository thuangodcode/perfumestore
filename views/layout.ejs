<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title || "Perfume Store" %></title>
  <link rel="stylesheet" href="/style.css">
  <style>
    /* Toast CSS */
    #toastContainer {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
    }
    .toast {
      background-color: #4caf50;
      color: #fff;
      padding: 10px 20px;
      margin-bottom: 10px;
      border-radius: 5px;
      opacity: 1;
      transition: opacity 0.5s, transform 0.3s;
    }
    .toast.hide {
      opacity: 0;
      transform: translateY(-20px);
    }
    .toast.error {
      background-color: #f44336;
    }
  </style>
</head>

<body>
  <nav>
    <div>
      <% if (!(user && user.isAdmin)) { %>
        <li><a href="/">Home</a></li>
      <% } %>
    </div>

    <div>
      <% if (!user) { %>
        <a href="/login">Login</a>
        <a href="/register">Sign Up</a>
      <% } else { %>
        <span class="username">
          <a href="/profile"><%= user.name %></a>
        </span>
        <a href="#" class="btn-logout" onclick="openLogoutModal(event)">Logout</a>
      <% } %>
    </div>
  </nav>

  <main>
    <%- body %>
  </main>

  <footer>
    <p>© 2025 Perfume Store. All rights reserved.</p>
  </footer>

  <!-- Toast container -->
  <div id="toastContainer"></div>

  <script>
    function showToast(message, type='success') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => {
        toast.classList.add('hide');
        setTimeout(() => toast.remove(), 500);
      }, 3000);
    }

    // ✅ Hiển thị flash messages từ server
    <% if (successMessage && successMessage.length > 0) { %>
      showToast('<%= successMessage[0] %>', 'success');
    <% } %>
    <% if (errorMessage && errorMessage.length > 0) { %>
      showToast('<%= errorMessage[0] %>', 'error');
    <% } %>

    // Logout modal
    function openLogoutModal(event) {
      event.preventDefault();
      document.getElementById('logoutModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function closeLogoutModal() {
      document.getElementById('logoutModal').classList.remove('active');
      document.body.style.overflow = 'auto';
    }
    function confirmLogout() {
      window.location.href = '/logout';
    }

    const logoutModal = document.getElementById('logoutModal');
    logoutModal.addEventListener('click', (e) => {
      if (e.target.id === 'logoutModal') closeLogoutModal();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeLogoutModal();
    });
  </script>

  <!-- Logout Modal -->
  <div id="logoutModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3>Confirm Logout</h3>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to logout from the system?</p>
      </div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="closeLogoutModal()">Cancel</button>
        <button class="btn-confirm danger" onclick="confirmLogout()">Logout</button>
      </div>
    </div>
  </div>
</body>
</html>
